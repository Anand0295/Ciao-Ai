name: Code Review with Groq AI

# Trigger this workflow on push and pull request events
on:
  push:
    branches:
      - main
      - develop
  pull_request:
    branches:
      - main
      - develop

jobs:
  code-review:
    runs-on: ubuntu-latest
    
    steps:
      # Step 1: Check out the repository code
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Fetch all history for better analysis
      
      # Step 2: Set up Node.js environment
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'  # Specify your Node.js version
          cache: 'npm'
      
      # Step 3: Install dependencies
      - name: Install dependencies
        run: npm ci
      
      # Step 4: Run code review script with Groq API
      # TODO: Add your Groq API key as a GitHub secret named 'GROQ_API_KEY'
      # Go to: Settings > Secrets and variables > Actions > New repository secret
      - name: Run AI Code Review
        env:
          GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}  # Your Groq API key from secrets
          # Add other environment variables as needed:
          # GROQ_MODEL: llama-3.1-70b-versatile  # Specify Groq model
        run: |
          # TODO: Replace with your actual code review script
          # Example: node scripts/code-review.js
          # Or: node src/index.js review
          echo "Running code review with Groq API..."
          # Uncomment and modify the line below:
          # node your-code-review-script.js
      
      # Step 5 (Optional): Post review results as a comment
      # Uncomment this step if you want to post results to PR
      # - name: Comment PR with review results
      #   if: github.event_name == 'pull_request'
      #   uses: actions/github-script@v7
      #   with:
      #     script: |
      #       const fs = require('fs');
      #       // Read review results from a file generated by your script
      #       // const reviewResults = fs.readFileSync('review-results.txt', 'utf8');
      #       // github.rest.issues.createComment({
      #       //   issue_number: context.issue.number,
      #       //   owner: context.repo.owner,
      #       //   repo: context.repo.repo,
      #       //   body: reviewResults
      #       // });

# GROQ API INTEGRATION NOTES:
# 1. Get your Groq API key from: https://console.groq.com/keys
# 2. Add it as a GitHub secret: GROQ_API_KEY
# 3. Install Groq SDK in your project: npm install groq-sdk
# 4. Example Groq integration in your script:
#    const Groq = require('groq-sdk');
#    const groq = new Groq({ apiKey: process.env.GROQ_API_KEY });
#    const response = await groq.chat.completions.create({
#      messages: [{ role: 'user', content: 'Review this code...' }],
#      model: 'llama-3.1-70b-versatile',
#    });
